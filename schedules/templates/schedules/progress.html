{% extends "schedules/schedule.html" %}
{% block progress %}
<div>
	<h1 id='progress-message'>Waiting</h1>
	<div id="progress-bar-outer">
		<div id="progress-bar-inner"></div>
	</div>
</div>
{% if task_id %}
<script type="text/javascript">
	console.log('Task Began');
	console.log('{{ task_id }}');
	jQuery(document).ready(function() {
		var check_state_again = true;
		// pole state of the current task
		var PollState = function(task_id) {
			jQuery.ajax({
				url: "track",
				type: "POST",
				data: "task_id=" + task_id,
			}).done(function(task){
				console.log(task);
				if (task.process_percent) {
					console.log(task.message)
					console.log(task.process_percent)
					jQuery('#progress-bar-inner').css({'width': task.process_percent + '%'});

					jQuery('#progress-message').html(task.message + ': ' + task.process_percent + '%')
				} else {
					console.log('Task Complete');
					check_state_again = false;
				};
				
				// create the infinite loop of Ajax calls to check the state
				// of the current task
				if (check_state_again) {
					PollState(task_id);
				} else {
					// window.location = "{% url 'schedules:schedule' %}"
				}
			});
		}
		PollState('{{ task_id }}');
	});
</script>
{% endif %}
{% endblock %}